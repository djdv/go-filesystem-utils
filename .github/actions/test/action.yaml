name: "Go tests"
description: "Runs the standard Golang test suite"
runs:
  using: "composite"
  steps:
    - uses: ./.github/actions/setup
    - if: runner.os == 'Windows'
      shell: pwsh
      run: |
        $incDir = $(Join-Path (${ENV:ProgramFiles(x86)} ?? $ENV:ProgramFiles) "WinFsp" "inc" "fuse")
        "CPATH=$incDir" >> $env:GITHUB_ENV
    - shell: pwsh
      env:
        CPATH: ${{env.CPATH}}
      run: |
        $commandPath = $(Join-Path . ...)
        go test -cover ${commandPath}
        go test -race ${commandPath}
